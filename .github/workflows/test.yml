name: Test Lightning Runner

on:
  workflow_dispatch:

jobs:
  test:
    name: Stress Test via Docker
    runs-on: [self-hosted, lightning-fast]
    container:
      image: polinux/stress-ng  # Docker Hub image with stress-ng installed
    steps:
      - name: Print system info inside container
        run: |
          echo "Running inside stress-ng container"
          stress-ng --version

      - name: CPU stress test (4 workers for 30s)
        run: |
          echo "Starting CPU stress test..."
          stress-ng --cpu 4 --timeout 30s

      - name: RAM stress test (2GB for 30s)
        run: |
          echo "Starting RAM stress test..."
          stress-ng --vm 2 --vm-bytes 1G --timeout 30s

      - name: Combined CPU and RAM stress test
        run: |
          echo "Running combined CPU and RAM stress test..."
          stress-ng --cpu 2 --vm 2 --vm-bytes 1G --timeout 30s

      - name: Cleanup
        if: always()
        run: echo "Stress test completed inside container âœ…"
